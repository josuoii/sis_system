{% extends 'base.html' %}

{% block title %}Admin Dashboard - SIS{% endblock %}

{% block content %}
<div class="space-y-8">
    <!-- Welcome Header -->
    <div class="bg-gradient-to-r from-blue-200 via-blue-400 to-blue-500 rounded-2xl p-8 text-white shadow-md">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
            <div>
                <h1 class="text-3xl md:text-4xl font-bold mb-1">System Administration</h1>
                <p class="text-blue-50 text-lg">{{ current_date|date:"l, F j, Y" }}</p>
                <p class="text-blue-100 text-sm mt-1">Welcome back, Administrator {{ user.get_full_name }}</p>
            </div>
            <div class="text-right">
                <div class="text-3xl font-bold">{{ system_stats.total_users }}</div>
                <div class="text-blue-50 text-sm">Total Users</div>
            </div>
        </div>
    </div>

    <!-- System Overview Stats -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="bg-blue-400 rounded-2xl p-6 flex flex-col items-center justify-center shadow-md min-w-[180px] min-h-[120px]">
            <div class="bg-blue-200 rounded-full p-3 mb-2">
                <i class="fas fa-user-graduate text-blue-600 text-2xl"></i>
            </div>
            <div class="text-3xl font-bold text-white">{{ system_stats.total_students }}</div>
            <div class="text-sm text-blue-50 font-medium mt-1">Students</div>
        </div>
        <div class="bg-blue-400 rounded-2xl p-6 flex flex-col items-center justify-center shadow-md min-w-[180px] min-h-[120px]">
            <div class="bg-blue-200 rounded-full p-3 mb-2">
                <i class="fas fa-chalkboard-teacher text-blue-600 text-2xl"></i>
            </div>
            <div class="text-3xl font-bold text-white">{{ system_stats.total_teachers }}</div>
            <div class="text-sm text-blue-50 font-medium mt-1">Teachers</div>
        </div>
        <div class="bg-blue-400 rounded-2xl p-6 flex flex-col items-center justify-center shadow-md min-w-[180px] min-h-[120px]">
            <div class="bg-blue-200 rounded-full p-3 mb-2">
                <i class="fas fa-users text-blue-600 text-2xl"></i>
            </div>
            <div class="text-3xl font-bold text-white">{{ system_stats.total_parents }}</div>
            <div class="text-sm text-blue-50 font-medium mt-1">Parents</div>
        </div>
        <div class="bg-blue-400 rounded-2xl p-6 flex flex-col items-center justify-center shadow-md min-w-[180px] min-h-[120px]">
            <div class="bg-blue-200 rounded-full p-3 mb-2">
                <i class="fas fa-clipboard-list text-blue-600 text-2xl"></i>
            </div>
            <div class="text-3xl font-bold text-white">{{ system_stats.total_interventions }}</div>
            <div class="text-sm text-blue-50 font-medium mt-1">Interventions</div>
        </div>
    </div>

    <!-- Intervention Stats -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="bg-blue-400 rounded-2xl p-6 flex flex-col items-center justify-center shadow-md min-w-[180px] min-h-[120px]">
            <div class="bg-blue-200 rounded-full p-3 mb-2">
                <i class="fas fa-play-circle text-blue-600 text-2xl"></i>
            </div>
            <div class="text-3xl font-bold text-white">{{ system_stats.active_interventions }}</div>
            <div class="text-sm text-blue-50 font-medium mt-1">Active Interventions</div>
        </div>
        <div class="bg-blue-400 rounded-2xl p-6 flex flex-col items-center justify-center shadow-md min-w-[180px] min-h-[120px]">
            <div class="bg-blue-200 rounded-full p-3 mb-2">
                <i class="fas fa-check-circle text-blue-600 text-2xl"></i>
            </div>
            <div class="text-3xl font-bold text-white">{{ system_stats.completed_interventions }}</div>
            <div class="text-sm text-blue-50 font-medium mt-1">Completed</div>
        </div>
        <div class="bg-blue-400 rounded-2xl p-6 flex flex-col items-center justify-center shadow-md min-w-[180px] min-h-[120px]">
            <div class="bg-blue-200 rounded-full p-3 mb-2">
                <i class="fas fa-clock text-blue-600 text-2xl"></i>
            </div>
            <div class="text-3xl font-bold text-white">{{ pending_approvals }}</div>
            <div class="text-sm text-blue-50 font-medium mt-1">Pending Approvals</div>
        </div>
    </div>

    <!-- Class Management Section -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow">
        <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
            <h3 class="text-lg font-semibold text-blue-700 dark:text-blue-300 flex items-center">
                <i class="fas fa-chalkboard mr-2"></i>Class Management
            </h3>
            <a href="{% url 'intervention:class-list' %}" class="text-blue-600 hover:text-blue-800 text-sm font-medium transition">View All Classes</a>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <a href="{% url 'intervention:class-list' %}" class="bg-blue-500 hover:bg-blue-600 text-white rounded-xl p-4 text-center font-medium shadow transition">
                    <i class="fas fa-list text-2xl mb-2 block"></i>
                    <div>View Classes</div>
                    <div class="text-xs opacity-75">Browse all classes</div>
                </a>
                <a href="{% url 'intervention:class-create' %}" class="bg-blue-500 hover:bg-blue-600 text-white rounded-xl p-4 text-center font-medium shadow transition">
                    <i class="fas fa-plus text-2xl mb-2 block"></i>
                    <div>Create Class</div>
                    <div class="text-xs opacity-75">Add new class</div>
                </a>
                <div class="bg-blue-50 dark:bg-blue-900 p-4 rounded-xl text-center">
                    <i class="fas fa-chalkboard-teacher text-2xl mb-2 block text-blue-600"></i>
                    <div class="font-medium text-gray-900 dark:text-white">{{ system_stats.total_classes|default:0 }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-300">Total Classes</div>
                </div>
                <div class="bg-blue-50 dark:bg-blue-900 p-4 rounded-xl text-center">
                    <i class="fas fa-user-plus text-2xl mb-2 block text-blue-600"></i>
                    <div class="font-medium text-gray-900 dark:text-white">{{ unassigned_students|default:0 }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-300">Unassigned Students</div>
                </div>
            </div>
            <!-- Recent Classes with Quick Actions -->
            {% if recent_classes %}
            <div>
                <h4 class="text-md font-semibold text-blue-700 dark:text-blue-300 mb-3">Recent Classes</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for class in recent_classes %}
                    <div class="bg-white dark:bg-gray-800 p-4 rounded-xl shadow flex flex-col justify-between">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h5 class="font-medium text-gray-900 dark:text-white">{{ class.name }}</h5>
                                <p class="text-sm text-gray-500 dark:text-gray-300">{{ class.subject }}</p>
                            </div>
                            <span class="px-2 py-1 bg-blue-100 text-blue-700 text-xs rounded">
                                {{ class.academic_year }}
                            </span>
                        </div>
                        <div class="text-xs text-gray-500 dark:text-gray-300 mb-3">
                            <div><i class="fas fa-user-tie mr-1"></i>{{ class.teacher.user_profile.user.get_full_name }}</div>
                            <div><i class="fas fa-users mr-1"></i>{{ class.students.count }} student{{ class.students.count|pluralize }}</div>
                            {% if class.room_number %}
                            <div><i class="fas fa-door-open mr-1"></i>Room {{ class.room_number }}</div>
                            {% endif %}
                        </div>
                        <div class="flex gap-2">
                            <a href="{% url 'intervention:class-detail' class.pk %}" class="flex-1 px-3 py-1 bg-blue-500 hover:bg-blue-600 rounded text-white text-center text-xs font-medium shadow transition">
                                <i class="fas fa-eye mr-1"></i>View
                            </a>
                            <a href="{% url 'intervention:assign-students' class.pk %}" class="flex-1 px-3 py-1 bg-blue-500 hover:bg-blue-600 rounded text-white text-center text-xs font-medium shadow transition">
                                <i class="fas fa-user-plus mr-1"></i>Assign
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% else %}
            <div class="text-center py-8">
                <i class="fas fa-chalkboard text-4xl text-blue-200 mb-3"></i>
                <p class="text-gray-500 mb-4">No classes created yet</p>
                <a href="{% url 'intervention:class-create' %}" class="inline-flex items-center px-4 py-2 bg-blue-500 hover:bg-blue-600 rounded-md text-white text-sm font-medium shadow transition">
                    <i class="fas fa-plus mr-2"></i>Create First Class
                </a>
            </div>
            {% endif %}
        </div>
    </div>

    <!-- User Management Section -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow">
        <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
            <h3 class="text-lg font-semibold text-blue-700 dark:text-blue-300 flex items-center">
                <i class="fas fa-users-cog mr-2"></i>User Management
            </h3>
            <a href="{% url 'intervention:user-management' %}" class="text-blue-600 hover:text-blue-800 text-sm font-medium transition">View All Users</a>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <a href="{% url 'intervention:user-management' %}" class="bg-blue-500 hover:bg-blue-600 text-white rounded-xl p-4 text-center font-medium shadow transition">
                    <i class="fas fa-list text-2xl mb-2 block"></i>
                    <div>View Users</div>
                    <div class="text-xs opacity-75">Browse all users</div>
                </a>
                <a href="{% url 'intervention:create-user' %}" class="bg-blue-500 hover:bg-blue-600 text-white rounded-xl p-4 text-center font-medium shadow transition">
                    <i class="fas fa-user-plus text-2xl mb-2 block"></i>
                    <div>Create User</div>
                    <div class="text-xs opacity-75">Add new user</div>
                </a>
                <div class="bg-blue-50 dark:bg-blue-900 p-4 rounded-xl text-center">
                    <i class="fas fa-users text-2xl mb-2 block text-blue-600"></i>
                    <div class="font-medium text-gray-900 dark:text-white">{{ system_stats.total_users|default:0 }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-300">Total Users</div>
                </div>
                <div class="bg-blue-50 dark:bg-blue-900 p-4 rounded-xl text-center">
                    <i class="fas fa-user-clock text-2xl mb-2 block text-blue-600"></i>
                    <div class="font-medium text-gray-900 dark:text-white">{{ monthly_stats.new_users|default:0 }}</div>
                    <div class="text-xs text-gray-500 dark:text-gray-300">New This Month</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Monthly Stats -->
    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow">
        <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">
            <h3 class="text-lg font-semibold text-blue-700 dark:text-blue-300 flex items-center">
                <i class="fas fa-chart-bar mr-2"></i>This Month's Activity
            </h3>
        </div>
        <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="text-center">
                    <div class="text-3xl font-bold text-blue-600 mb-2">{{ monthly_stats.new_users }}</div>
                    <div class="text-sm text-gray-500 dark:text-gray-300">New Users</div>
                    <div class="text-xs text-gray-400 mt-1">Registered this month</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-blue-600 mb-2">{{ monthly_stats.new_interventions }}</div>
                    <div class="text-sm text-gray-500 dark:text-gray-300">New Interventions</div>
                    <div class="text-xs text-gray-400 mt-1">Created this month</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-blue-600 mb-2">{{ monthly_stats.completed_interventions }}</div>
                    <div class="text-sm text-gray-500 dark:text-gray-300">Completed</div>
                    <div class="text-xs text-gray-400 mt-1">Finished this month</div>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Recent Users -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow">
            <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-blue-700 dark:text-blue-300 flex items-center">
                    <i class="fas fa-user-plus mr-2"></i>Recent Users
                </h3>
                <a href="{% url 'intervention:user-management' %}" class="text-blue-600 hover:text-blue-800 text-sm font-medium transition">Manage Users</a>
            </div>
            <div class="p-6">
                {% if recent_users %}
                    <div class="space-y-3">
                        {% for user_profile in recent_users %}
                            <div class="bg-blue-50 dark:bg-blue-900 p-3 rounded-xl flex items-center justify-between">
                                <div class="flex items-center">
                                    <div class="w-10 h-10 rounded-full bg-blue-200 flex items-center justify-center text-blue-700 font-bold">
                                        {{ user_profile.user.first_name.0|default:user_profile.user.username.0 }}{{ user_profile.user.last_name.0|default:'' }}
                                    </div>
                                    <div class="ml-3">
                                        <div class="font-medium text-gray-900 dark:text-white text-sm">{{ user_profile.user.get_full_name|default:user_profile.user.username }}</div>
                                        <div class="text-gray-500 dark:text-gray-300 text-xs">{{ user_profile.get_user_type_display }}</div>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-xs text-gray-500 dark:text-gray-300">{{ user_profile.created_at|date:"M j" }}</div>
                                    <span class="px-2 py-1 text-xs rounded-full bg-blue-100 text-blue-700">
                                        {{ user_profile.user_type }}
                                    </span>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-gray-500 text-center py-4">No recent users.</p>
                {% endif %}
            </div>
        </div>
        <!-- Recent Interventions -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow">
            <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-lg font-semibold text-blue-700 dark:text-blue-300 flex items-center">
                    <i class="fas fa-clipboard-list mr-2"></i>Recent Interventions
                </h3>
                <a href="{% url 'intervention:intervention-list' %}" class="text-blue-600 hover:text-blue-800 text-sm font-medium transition">View All</a>
            </div>
            <div class="p-6">
                {% if recent_interventions %}
                    <div class="space-y-3">
                        {% for intervention in recent_interventions %}
                            <div class="bg-blue-50 dark:bg-blue-900 p-3 rounded-xl">
                                <div class="flex justify-between items-start mb-2">
                                    <h4 class="font-medium text-gray-900 dark:text-white text-sm">
                                        <a href="{% url 'intervention:intervention-detail' intervention.pk %}" class="hover:text-blue-700">
                                            {{ intervention.title|truncatechars:30 }}
                                        </a>
                                    </h4>
                                    <span class="px-2 py-1 text-xs rounded-full {% if intervention.status == 'ACTIVE' %}bg-green-100 text-green-600{% elif intervention.status == 'COMPLETED' %}bg-blue-100 text-blue-700{% else %}bg-gray-100 text-gray-600{% endif %}">
                                        {{ intervention.status }}
                                    </span>
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-300 mb-2">
                                    <i class="fas fa-user-graduate mr-1"></i>{{ intervention.student.user_profile.user.get_full_name }}
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-300">
                                    <i class="fas fa-calendar-alt mr-1"></i>{{ intervention.start_date|date:"M j, Y" }} - {% if intervention.end_date %}{{ intervention.end_date|date:"M j, Y" }}{% else %}Ongoing{% endif %}
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-gray-500 text-center py-4">No recent interventions.</p>
                {% endif %}
            </div>
        </div>
        <!-- Recent Audit Log -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow lg:col-span-2">
            <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-blue-700 dark:text-blue-300 flex items-center">
                    <i class="fas fa-history mr-2"></i>Recent Audit Log
                </h3>
            </div>
            <div class="p-6">
                {% if recent_activities %}
                    <div class="space-y-4 max-h-64 overflow-y-auto">
                        {% for log in recent_activities %}
                            <div class="flex items-center justify-between">
                                <div class="flex items-center">
                                    {% if log.action_type == 'LOGIN' %}
                                        <div class="w-8 h-8 rounded-full bg-green-100 flex items-center justify-center text-green-600">
                                            <i class="fas fa-sign-in-alt text-sm"></i>
                                        </div>
                                    {% elif log.action_type == 'LOGOUT' %}
                                        <div class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-600">
                                            <i class="fas fa-sign-out-alt text-sm"></i>
                                        </div>
                                    {% else %}
                                        <div class="w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                                            <i class="fas fa-info-circle text-sm"></i>
                                        </div>
                                    {% endif %}
                                    <div class="ml-3">
                                        <p class="text-sm text-gray-700 dark:text-gray-200">
                                            <span class="font-medium">by {% if log.user %}{{ log.user.get_full_name|default:log.user.username }}{% else %}System{% endif %}</span>
                                            <br>
                                            <span class="text-xs text-gray-500 dark:text-gray-300">{{ log.action }}{% if log.details %}: {{ log.details }}{% endif %}</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="text-xs text-gray-500 dark:text-gray-300">{{ log.timestamp|timesince }} ago</div>
                            </div>
                        {% endfor %}
                    </div>
                {% else %}
                    <p class="text-gray-500 text-center py-4">No recent audit logs.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

  